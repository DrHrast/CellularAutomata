<div class="container">
  <div class="form-container">
    <div class="ca-form-card">
      <form (ngSubmit)="onRun()" #caForm="ngForm" class="form-shell">
        <h2 class="panel-title">1D Cellular Automata</h2>

        <div class="neighborhood-check">
          <label class="toggle-row">
            <input
              type="checkbox"
              (click)="expandeNeighborhood($event)"
            />
            <span>Expanded neighborhood</span>
          </label>

          <span class="hint">
            {{ useExpandedNeighborhood ? 'radius 2 (rule = 32 bits)' : 'radius 1 (rule = 8 bits)' }}
          </span>
        </div>

        <div class="rule-section">
          <div *ngIf="!useExpandedNeighborhood">
            <label class="field-label" for="rule">Rule (0–255)</label>
            <input
              class="text-input"
              id="rule"
              name="rule"
              type="text"
              [(ngModel)]="ruleDecimal"
              (ngModelChange)="onRuleChange($event)"
              inputmode="numeric"
              placeholder="30"
              autocomplete="off"
              aria-describedby="ruleHelp"
            />
          </div>

          <div *ngIf="useExpandedNeighborhood">
            <label class="field-label" for="rule32">Rule (0–4,294,967,295)</label>
            <input
              class="text-input"
              id="rule32"
              name="rule32"
              type="text"
              [(ngModel)]="rule32bitDecimal"
              (ngModelChange)="onRuleChange($event)"
              inputmode="numeric"
              placeholder="300"
              autocomplete="off"
              aria-describedby="ruleHelp"
            />
          </div>
        </div>

        <div class="field-two">
          <div class="field-block">
            <label class="field-label" for="cells">Cells</label>
            <input
              class="text-input"
              id="cells"
              name="cells"
              type="number"
              min="8"
              max="4096"
              placeholder="99"
              [(ngModel)]="gridNOfColumns"
              (ngModelChange)="onSpecsChange($event)"
            />
          </div>

          <div class="field-block">
            <label class="field-label" for="generations">Generations</label>
            <input
              class="text-input"
              id="generations"
              name="generations"
              type="number"
              min="1"
              max="4096"
              placeholder="100"
              [(ngModel)]="generations"
              (ngModelChange)="onSpecsChange($event)"
            />
          </div>

          <div class="field-block">
            <label class="field-label" for="steps">Rows / step</label>
            <input
              class="text-input"
              id="steps"
              name="steps"
              type="number"
              min="1"
              max="20"
              placeholder="5"
              [(ngModel)]="stepCount"
            />
          </div>
        </div>

        <div class="actions">
          <button type="button" class="btn ghost" (click)="onClick()">Step</button>
          <button type="button" class="btn ghost" (click)="randomizeSeed()">Randomize Seed</button>
        </div>

        <div class="main-actions">
          <button type="button" class="btn primary" (click)="play()">▶</button>
          <button type="button" class="btn warning" (click)="stop()">❚❚</button>
          <button type="button" class="btn danger" (click)="resetGrid()">Reset</button>
        </div>

        <small id="ruleHelp" *ngIf="ruleDecimal && !isRuleValid" class="error-text">
          Must be between 0 and 255.
        </small>
      </form>
    </div>
  </div>
  <div class="grid">
    <div class="grid-row" *ngFor="let row of rows">
      <div class="cell" *ngFor="let cell of row" [class.alive]="cell === 1"></div>
    </div>
  </div>
</div>
